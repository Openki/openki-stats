<template name="profile">
	<div class="container-sm">
		<div class="page-component">
			<h1>
				<span class="fa fa-cogs fa-fw" aria-hidden="true"></span>
				{{mf 'login.frame.settings'}}
			</h1>
		</div>
		{{#if notificationsUnsubscribeSuccess}}
			<div class="alert alert-success" role="alert">
				<span class="fa-stack fa-lg">
					<i class="fa fa-envelope-o fa-stack-1x"></i>
					<i class="fa fa-ban fa-stack-2x"></i>
				</span>
				{{mf 'notifications.unsubscribeSuccess' 'You have successfully unsubscribed from automated notifications.'}}
			</div>
		{{/if}}
		{{#if privateMessagesUnsubscribeSuccess}}
			<div class="alert alert-success" role="alert">
				<span class="fa-stack fa-lg">
					<i class="fa fa-envelope-o fa-stack-1x"></i>
					<i class="fa fa-ban fa-stack-2x"></i>
				</span>
				{{mf 'privateMessages.unsubscribeSuccess' 'You have successfully unsubscribed from private messages from users.'}}
			</div>
		{{/if}}
		{{#if unsubscribeError}}
			<div class="alert alert-danger" role="alert">
				<span class="fa-stack fa-lg">
					<i class="fa fa-envelope-o fa-stack-1x"></i>
					<i class="fa fa-ban fa-stack-2x"></i>
				</span>
				{{mf 'notifications.unsubscribeError' 'There has been an error with your unsubscription. Please Try again.'}}
			</div>
		{{/if}}
		{{#unless currentUser}}
			{{mf 'profile.not_logged_in' 'You are not logged in'}}
		{{else}}
			<div class="page-component">
				<div class="profile-header edit-profile-header">
					<div class="profile-avatar">
						{{> avatarForm }}
					</div>

					<div class="profile-header-info">
						<h2 class="profile-title">
							{{> editable editableName}}
						</h2>

						<p class="profile-description">
							{{> editable editableDescription}}
						</p>

						<a class="btn btn-primary"
						   href="{{pathFor 'userprofile' _id=currentUser._id}}">
							<span class="fa fa-user-circle-o fa-fw" aria-hidden="true"></span>
							{{mf 'login.frame.profile' 'Public profile'}}
						</a>
					</div>
				</div>
			</div>

			<div class="page-component page-component-seperated">
				<h3>{{mf 'profile.email_settings' 'E-Mail settings'}}</h3>

				<div class="row">
					<div class="col-sm-6">
						{{#if user.email}}
							<form class="js-email-form">
								<div class="form-group {{errorClass 'email'}}">
									<label for="editform_email" class="sr-only">
										{{mf 'profile.email' 'E-Mail'}}
									</label>
									<div class="edit-profile-email">
										<input class="form-control js-email" id="editform_email"
											   type="text" value="{{user.email}}" />

										{{> buttonSave}}
									</div>
									{{#unless user.verified}}
										<div class="details-info-group">
											<div class="details-info-data">
												{{> verifyEmail}}
											</div>
										</div>
									{{/unless}}
									{{errorMessage 'email'}}
								</div>
							</form>
						{{/if}}
					</div>
					<div class="col-sm-6">
						<div class="form-group">
							<div class="checkbox edit-profile-checkbox">
								<label>
									<input type="checkbox" class="js-notifications"
										   {{notificationsChecked}} />
									{{mf 'profile.toggle.notifications' 'Receive automated notifications via email'}}
								</label>
							</div>
							<div class="checkbox edit-profile-checkbox">
								<label>
									<input type="checkbox" class="js-allowPrivateMessages"
										   {{allowPrivateMessagesChecked}} />
									{{mf 'profile.toggle.allowPrivateMessages' 'Receive private messages from users via email'}}
								</label>
							</div>
						</div>
					</div>
				</div>
			</div>
			{{#if tenantCount}}
				<div class="page-component page-component-seperated profile-tenant-list">
					<h3>{{mf 'profile.tenants' 'My organizations'}}</h3>
					<h5>
						{{#mf KEY='profile.tenantMembership' NUM_TENANTS=tenantCount}}
						You are {NUM_TENANTS, plural, =0 {not admin of any organization} =1 {admin of the organization:} other {admin of # organizations:}}
						{{/mf}}
					</h5>
					<ul class="tenants">
						{{#each tenant in user.tenants}}
							<li>
								<div class="tag tag-link tenant-tag">
									<a href="{{pathFor 'tenantDetails' _id=tenant._id}}">
										{{tenant.name}}
									</a>
								</div>
							</li>
						{{/each}}
					</ul>
				</div>
			{{/if}}

			<div class="page-component page-component-seperated profile-grouplist">
				<h3>{{mf 'profile.groups' 'My groups'}}</h3>
				<h5>
					{{#mf KEY='profile.groupMembership' NUM_GROUPS=groupCount}}
						You are {NUM_GROUPS, plural, =0 {not member of any group} =1 {member of the group:} other {member of # groups:}}
					{{/mf}}
				</h5>
				<ul class="groups">
					{{#each group in user.groups}}
						<li>{{> groupNameFull group._id}}</li>
					{{/each}}
				</ul>
				<a class="btn btn-add" href="{{pathFor 'groupDetails' _id='create'}}">
					<span class="fa fa-plus fa-fw" aria-hidden="true"></span>
					{{mf 'profile.createNewGroup.button' 'Create a new group'}}
				</a>
			</div>
			<div class="page-component page-component-seperated profile-venues-list">
				<h3>{{mf 'profile.venues' 'My venues:'}}</h3>
				{{#if isVenueEditor}}
					<ul class="list-unstyled">
						{{#each venue in user.venues}}
							<li>{{> venueLink venue=venue}}</li>
						{{/each}}
					</ul>
				{{else}}
					<p>{{mf 'userprofile.noOwnVenues' "You're not editor of any venue."}}</p>
				{{/if}}
				<a class="btn btn-add" href="{{pathFor 'venueDetails' _id='create'}}">
					<span class="fa fa-plus fa-fw" aria-hidden="true"></span>
					{{mf 'profile.createNewVenue.button' 'Create a new venue'}}
				</a>
			</div>
			<div class="page-component page-component-seperated">
				<h3>{{mf 'profile.danger_zone' 'Danger zone'}}</h3>

				<div class="edit-profile-password">
					{{#unless changingPass}}
						<button type="button" class="btn btn-default js-change-pwd-btn">
							<span class="fa fa-lock fa-fw" aria-hidden="true"></span>
							{{mf 'profile.changePass' 'Change my password'}}
						</button>
					{{/unless}}
					{{#if changingPass}}
						<div class="details-form">
							<form class="js-change-pwd form-horizontal">
								<div class="form-group">
									<label for="oldpassword" class="control-label">
										{{mf 'profile.input.oldPassword' 'Your current password'}}
									</label>
									<div class="control-input">
										<input type="password" class="js-old-pwd form-control"
											   id="oldpassword" value="" />
									</div>
								</div>
								<div class="form-group">
									<label for="newpassword" class="control-label">
										{{mf 'profile.input.newPassword' 'New password'}}
									</label>
									<div class="control-input">
										<input type="password" class="js-new-pwd form-control"
											   id="newpassword" value="" />
									</div>
								</div>
								<div class="form-group">
									<label for="newpassword_confirm" class="control-label">
										{{mf 'profile.input.repeatPassword' 'Repeat new password'}}
									</label>
									<div class="control-input">
										<input type="password"
											   class="js-new-pwd-confirm form-control"
											   id="newpassword_confirm" value="" />
									</div>
								</div>
								<div class="form-actions">
									{{> buttonSave}}
									{{> buttonCancel event="js-change-pwd-cancel"}}
								</div>
							</form>
						</div>
					{{/if}}
				</div>
				<div class="edit-profile-delete">
					{{#unless expanded}}
						{{> buttonDelete event="js-expand"}}
					{{/unless}}
					{{#if expanded}}
						<div class="edit-profile-delete-confirmation">
							<p>{{mf 'profile.reallydelete' 'Please confirm that you would like to delete your profile. This cannot be undone, you will have to create a new account if you want to use this site again.'}}
							</p>
							<div class="form-actions">
								{{> buttonDeleteConfirm
									event="js-profile-delete-confirm-btn"
									textIdle=(mf 'profile.delete.confirm.button' 'Delete my user and all its profile')
									textBusy=(mf 'profile.delete.confirm.button.busy' 'Deleting profile...')
								}}
								{{> buttonCancel event="js-collapse"}}
							</div>
						</div>
					{{/if}}
				</div>
			</div>
		{{/unless}}
	</div>
</template>
