<template name="userprofile">
	<div class="container-sm">
		<div class="page-component">
			<div class="profile-header">
				<div class="profile-header-avatar">
					{{> avatar userId=userId class="profile-avatar"}}
				</div>

				<div class="profile-header-info">
					<h1 class="profile-title">
						{{mf 'profile.users_profile_page' "{NAME}'s Profile" NAME=this.user.username}}
						{{#if ownuser}}
							({{mf 'profile.its_you' "It's you!"}})
						{{/if}}
					</h1>

					<p class="profile-description">{{this.user.description}}</p>

					{{#if ownuser}}
						<a class="btn btn-primary" href="{{pathFor 'profile'}}">
							<span class="fa fa-cogs fa-fw" aria-hidden="true"></span>
							{{mf 'profile.preferenceslink' "Account settings"}}
						</a>
					{{else}}
						{{#if acceptsPrivateMessages}}
							{{> sendMessage recipientId=user._id}}
						{{/if}}
					{{/if}}
				</div>
			</div>
		</div>
		{{#if showSettings}}
			<div class="page-component page-component-seperated">
				<div class="mb-3">
					{{#if showPrivileges}}
						<div class="form-group-element">
							<h3>
								<span class="fa fa-cog fa-fw" aria-hidden="true"></span>
								{{mf 'privileges.title' 'Edit Privileges'}}
							</h3>
							<div class="list-group">
								{{#if privileges.admin}}
									<li class="list-group-item list-group-item-success">
										{{mf 'privilege.has.admin' 'Administrator privileges granted'}}
										{{#if alterPrivileges}}
											<button type="button"
													class="js-remove-privilege-btn close"
													data-tooltip="{{mf 'privilege.remove' 'Remove privilege'}}"
													data-priv="admin">
												&times;
											</button>
										{{/if}}
									</li>
								{{else}}
									{{#if alterPrivileges}}
										<button type="button" class="giveAdmin list-group-item">
											{{mf 'privilege.add.admin' 'Grant administrator privileges'}}
										</button>
									{{/if}}
								{{/if}}
							</div>
						</div>
					{{/if}}

					{{#if showInviteGroups}}
						<div class="form-group-element">
							<h3>
								<span class="fa fa-cog fa-fw" aria-hidden="true"></span>
								{{mf 'userprofile.groups.header' 'Edit groups'}}
							</h3>
							<div class="list-group">
								{{#each inviteGroups}}
									{{#if groupMember this ../user}}
										<li class="list-group-item list-group-item-success">
											{{mf 'profile.group.member' 'Member of group '}}
											<span class="group">{{name}}</span>
											<button type="button" class="js-group-expel-btn close"
													data-tooltip="{{mf 'profile.group.expel' 'Expel from group {GROUPNAME}' GROUPNAME=this.name}}">
												&times;
											</button>
										</li>
									{{else}}
										<button type="button"
												class="draftIntoGroup list-group-item">
											{{mf 'profile.group.draft' 'Draft into group '}}
											{{name}}
										</button>
									{{/if}}
								{{/each}}
							</div>
						</div>
					{{/if}}
				</div>
			</div>
		{{/if}}
		{{> usersCourselist profileData=this ownProfile=false}}

		{{#if alterPrivileges}}
			<h3 class="text-danger">{{mf 'profile.account.delete.header' 'Is this a SPAMER?'}}</h3>
			{{#unless verifyUserDelete}}
				{{> buttonDelete event="js-verify-user-delete-collapse"}}
			{{/unless}}
			{{#if verifyUserDelete}}
				<div class="profile-delete-confirmation">
					<p>{{mf 'profile.account.reallydelete' 'The user profile "{NAME}" will be permanently deleted. {COURSES, number} Courses created by this user (with {INTERESTED, number} Participants and {EVENTS, number} upcoming events) will be automatically removed as well. Are you sure you want to do this?' NAME=this.user.username COURSES=numberOfCoursesAffectedByDelete INTERESTED=numberOfInterestedAffectedByDelete EVENTS=numberOfFutureEventsAffectedByDelete}}
					</p>
					<div class="mb-3">
						<textarea class='form-control js-reason'
								  placeholder="{{mf 'profile.account.reason.placeholder' 'Reason for deleting this user'}}"></textarea>
					</div>
					<div class="form-actions">
						{{> buttonDeleteConfirm
						event="js-verify-user-delete-confirm"
						textIdle=(mf 'profile.account.delete.confirm.button' 'Delete user and all his traces')
						textBusy=(mf 'profile.account.delete.confirm.button.busy' 'Deleting profile...')
					}}
						{{> buttonCancel event="js-verify-user-delete-collapse"}}
					</div>
				</div>
			{{/if}}
		{{/if}}
	</div>
</template>
