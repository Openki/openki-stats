<template name="eventPage">
	<div class="container">
		{{> event}}
	</div>
</template>

<template name="eventNotFound">
	<h4>{{mf "event.no_event" "Sorry, we couldn't find this event, it must have been deleted or it never existed in the first place."}}</h4>
</template>

<template name="event">
	<div class="event-wrapper-main">
		{{#if course}}
			<div class="event-course-header">
				<h2>
					{{course.name}}
				</h2>
				<a href="{{pathFor 'showCourse' _id=courseId}}" class="event-course-header-link">
					<i class="fa fa-external-link"></i>
					{{mf 'event.details.viewCourse' 'view course'}}
				</a>
				{{> courseCategories course}}
				{{> regionTag}}
			</div>
		{{/if}}
		<div class="event">
			{{#if editing}}
				{{> eventEdit}}
			{{else}}
				{{> eventDisplay}}
			{{/if}}
		</div>
		<div class="page-component">
			{{> report}}
		</div>
	</div>
	{{#unless editing}}
		<div class="event-wrapper-aside">
			{{#if isFuture}}
				<div class="page-component">
					<div class="event-page-component-header">
						<h4>
							{{mf 'event.details.registration' 'Registration'}}
						</h4>
					</div>
				</div>
				<div class="page-component">
					<b>
						{{#unless userRegisteredForEvent}}
							{{mf 'event.details.i-participate-no' 'Let us know that you are participating in this event. Your registration is binding.'}}
						{{else}}
							{{mf 'event.details.i-participate-yes' 'You are now registered. Your registration is binding.'}}
						{{/unless}}
					</b>
				</div>
				<div class="page-component">
					{{#unless userRegisteredForEvent}}
						{{#if acceptsParticipants}}
							{{> buttonRegister event="js-register-event"}}
						{{else}}
							{{> buttonRegistrationClosed}}
						{{/if}}
					{{else}}
						{{> buttonUnregister event="js-unregister-event"}}
					{{/unless}}
				</div>
			{{/if}}
			<div class="page-component">
				{{> eventParticipants}}
			</div>
		</div>
	{{/unless}}
</template>

<template name="eventDisplay">
	<div class="page-component">
		<div class="details-header event-details-header">
				<span class="day">{{weekday startLocal}}</span><br>
				<span class="date">
					<span class="fa fa-calendar fa-fw" aria-hidden="true"></span>
					{{dateformat_mini_fullmonth startLocal}}
				</span>
				<span class="fa fa-clock-o fa-fw" aria-hidden="true"></span>
				{{timeformat startLocal}} - {{timeformat endLocal}}
		</div>
		<div class="details-body event-details-body">
			{{#unless courseId}}
				{{> regionTag}}
			{{/unless}}
			<div class="details-content">
				{{#if internal}}
					<span class="details-internal"
						data-tooltip="{{mf 'eventCompact.internal_event' 'Internal event'}}"></span>
				{{/if}}
				<h3>{{this.title}}</h3>
				<div class="tag-group multiline">
					{{> venueLink}}
					{{#if venue.address}}
						<div class="tag">
							<span class="fa fa-map-marker fa-fw" aria-hidden="true"></span>
							{{venue.address}}
						</div>
					{{/if}}
				</div>

				{{> eventGroupList}}

				<p class="event-details-description">
					{{#if hasVenue}}
						<div class="details-map">
							{{>map markers=eventMarkers}}
						</div>
					{{/if}}
					{{{description}}}
				</p>
			</div>
			{{> pricePolicy dismissable=true wrap='event-details-price-policy'}}
			{{> sharing}}
		</div>
		{{#if replicating}}
			{{>eventReplication}}
		{{/if}}
		{{#if mayEdit}}
			{{#if expanded}}
				{{> eventDeleteConfirmDialog}}
			{{else}}
				{{#unless replicating}}
					<div class="actions">
						{{> buttonEdit event="js-event-edit"}}
						<button type="button" class="btn btn-edit js-show-replication">
							<span class="fa fa-plus fa-fw" aria-hidden="true"></span>
							{{mf 'event.details.repl_menu_btn' 'Repeat'}}
						</button>
						<a
							class="btn btn-edit js-download js-track-cal-download"
							href="{{pathFor 'calEvent' this}}"
							title="{{mf 'event.detail.download_cal' 'Download event to my calendar'}}">
							<i class="fa fa-download fa-fw" aria-hidden="true"></i>
							{{mf 'event.details.download' 'Download'}}
						</a>
						{{> buttonDelete event="js-expand"}}
					</div>
				{{/unless}}
			{{/if}}
		{{/if}}
	</div>
</template>


<!-- COPYPASTA WARNING
    Below are slightly modified templates from course.details.html.
    Where possible, the original translation keys have been kept.

    Most of what is in these templates could be generalized across courses and
    events. It's the pesky translation strings where I think we'll run into
    trouble when we try to unite them.
-->
<template name="eventDeleteConfirmDialog">
	<div class="event-delete-confirmation">
		<p>{{mf 'event.reallydelete' 'Please confirm that you would like to delete this event. This cannot be undone.'}}</p>
		<div class="form-actions">
			{{> buttonDeleteConfirm
				event="js-event-delete-confirm"
				textIdle=(mf 'event.delete.confirm.button' 'Delete this event')
				textBusy=(mf 'event.delete.confirm.button.busy' 'Deleting event...')
			}}
			{{> buttonCancel event="js-collapse"}}
		</div>
	</div>
</template>

<template name="eventGroupList">
	<div class="tag-group multiline">
		{{#each allGroups}}
			{{> groupName}}
			{{#if isOrganizer}}
				<div class="tag group-tag addon">
					<span class="fa fa-bullhorn fa-fw" aria-hidden="true"></span>
				</div>
			{{/if}}
			{{#if tools}}
				<div class="btn-group tag-btn group-tag-btn addon">
					<button type="button" class="dropdown-toggle"
						aria-expanded="false"
						aria-haspopup="true"
						data-toggle="dropdown">
						<span class="fa fa-caret-down fa-fw" aria-hidden="true"></span>
					</button>
					<ul class="dropdown-menu dialog-dropdown">
						<li class="dropdown-header">
							{{mf 'grouplist.editgroup.header'}}
							<button class="close">&times;</button>
						</li>
						<li role="seperator" class="divider"></li>
						{{#each tools}}
							<li class="dialog-dropdown-btn">{{> toolTemplate}}</li>
						{{/each}}
					</ul>
				</div>
			{{/if}}
		{{/each}}
		{{> eventGroupAdd}}
	</div>
</template>


<template name="eventGroupAdd">
	{{#if groupsToAdd}}
		<div class="btn-group tag-btn group-tag-btn">
			<button type="button" class="dropdown-toggle"
				aria-expanded="false"
				aria-haspopup="true"
				data-toggle="dropdown">
				<span class="fa fa-plus fa-fw" aria-hidden="true"></span>
				<span>{{mf 'event.group.addText' 'link a group'}}</span>
				<span class="fa fa-caret-down fa-fw" aria-hidden="true"></span>
			</button>
			<ul class="dropdown-menu dialog-dropdown">
				<li class="dropdown-header">
					{{mf 'grouplist.addgroups.header'}}
					<button class="close">&times;</button>
				</li>
				<li role="seperator" class="divider"></li>
				{{#each groupsToAdd}}
					<li>
						<button
							class="btn-link js-add-group"
							type="button"
							value="{{this}}">
							{{name}}
						</button>
					</li>
				{{/each}}
				<li class="dialog-dropdown-btn">
					<a href="/group/create" class="btn btn-add">
						<span class="fa fa-plus fa-fw" aria-hidden="true"></span>
						{{mf 'profile.createNewGroup.button'}}
					</a>
				</li>
			</ul>
		</div>
	{{/if}}
</template>


<template name="eventGroupRemove">
	{{#if expanded}}
		<div class="group-tool-dialog danger">
			{{#with groupId}}
				{{mf 'event.group.confirmRemoveText' "Remove group {NAME} from this event?" NAME=name}}
			{{/with}}
			<button type="button" class="btn btn-remove js-remove">
				{{mf 'course.group.confirmRemoveButton'}}
			</button>
		</div>
	{{else}}
		<a href="#" class="js-expand btn btn-remove">
			<span class="fa fa-remove fa-fw" aria-hidden="true"></span>
			{{mf 'course.group.remove'}}
		</a>
	{{/if}}
</template>


<template name="eventGroupMakeOrganizer">
	{{#if expanded}}
		<div class="group-tool-dialog add">
			{{#with groupId}}
				{{mf 'course.group.confirmOrgText' NAME=name}}
			{{/with}}
			{{mf 'event.group.confirmOrgNotes' "All members of this group will be able to edit this event."}}
			<button type="button" class="btn btn-add js-makeOrganizer">
				{{mf 'course.group.confimOrgButton'}}
			</button>
		</div>
	{{else}}
		<a href="#" class="js-expand btn btn-add">
			<span class="fa fa-bullhorn fa-fw" aria-hidden="true"></span>
			{{mf 'course.group.addOrgText'}}
		</a>
	{{/if}}
</template>


<template name="eventGroupRemoveOrganizer">
	{{#if expanded}}
		<div class="group-tool-dialog danger">
			{{#with groupId}}
				{{mf 'course.group.confirmRemoveOrgText' NAME=name}}
			{{/with}}
			<button type="button" class="btn btn-remove js-removeOrganizer">
				{{mf 'course.group.confimRemoveOrgButton'}}
			</button>
		</div>
	{{else}}
		<a href="#" class="js-expand btn btn-remove">
			<span class="fa fa-remove fa-fw" aria-hidden="true"></span>
			{{mf 'course.group.removeOrgText' NAME=name}}
		</a>
	{{/if}}
</template>

<template name="buttonRegister">
	<button type="button" class="btn btn-add btn-event {{event}}" {{disabledIfBusy}}>
		{{#if busy 'registering'}}
			<span class="fa fa-circle-o-notch fa-spin fa-fw" aria-hidden="true"></span>
			{{mf '_button.registering' 'Registering...'}}
		{{else}}
			<span class="fa fa-user fa-fw" aria-hidden="true"></span>
			{{mf 'event.details.register' 'Register'}}
		{{/if}}
	</button>
</template>

<template name="buttonRegistrationClosed">
	<button
		type="button"
		class="btn btn-warning btn-event {{event}}"
		{{disabledIfBusy}}
	>
		{{#if busy 'registering'}}
			<span class="fa fa-circle-o-notch fa-spin fa-fw" aria-hidden="true"></span>
			{{mf '_button.addingYouToWaitingQueue' 'Adding you to waiting queue...'}}
		{{else}}
			<span class="fa fa-user fa-fw" aria-hidden="true"></span>
			{{mf 'event.details.isFullyBooked' 'Event is fully booked'}}
		{{/if}}
	</button>
</template>

<template name="buttonUnregister">
	<button type="button" class="btn btn-cancel btn-event {{event}}" {{disabledIfBusy}}>
		{{#if busy 'unregistering'}}
			<span class="fa fa-circle-o-notch fa-spin fa-fw" aria-hidden="true"></span>
			{{mf '_button.unregistering' 'Unregistering...'}}
		{{else}}
			<span class="fa fa-user fa-fw" aria-hidden="true"></span>
			{{mf 'event.details.unregister' 'Withdraw my registration'}}
		{{/if}}
	</button>
</template>
